<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="utf-8">
  <title>SampleDetector ¬∑ AutoCatalog ({{ version }})</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    body{font-family:-apple-system,Arial,sans-serif;padding:2rem;background:#0b0b0c;color:#e5e7eb}
    a{color:#93c5fd}
    .card{background:#121214;border:1px solid #222;border-radius:12px;padding:16px;margin-bottom:16px}
    input,button{color:#111}
    table{border-collapse:collapse;width:100%;margin-top:12px}
    th,td{border:1px solid #222;padding:8px;text-align:left}
    th{background:#18181b;color:#ddd}
    img{border-radius:8px}
  </style>
</head>
<body>
  <h1>üéõÔ∏è SampleDetector ¬∑ AutoCatalog <small>({{ version }})</small></h1>

  <div class="card">
    <h3>1) Ehita kataloog (ilma kasutaja uploadita)</h3>
    <form action="/autocatalog" method="post">
      <label>Otsingud (komaga):</label>
      <input style="width:60%" type="text" name="queries" value="james brown, aretha franklin, daft punk, funkadelic, the winstons">
      <label>Per query:</label>
      <input type="number" name="per_query" value="20" min="1" max="50">
      <button type="submit">Laadi preview'd ja indeksi</button>
    </form>
    <p>Kasutame iTunes Search API-d (30s preview). Hetkekataloog: <b>{{ meta.count if meta else 0 }}</b> lugu.</p>
  </div>

  <div class="card">
    <h3>2) Sk√§nni oma lugu (ainus upload)</h3>
    <form action="/scan" method="post" enctype="multipart/form-data">
      <input type="file" name="file" accept=".mp3,.wav,.m4a,.ogg,.aiff,.flac" required>
      <button type="submit">Sk√§nni</button>
    </form>
    <p>Anal√º√ºsib kuni 90 s sinu loost ja v√µrdleb kataloogiga. Tulemus: kahtlusalused vasteid (votes).</p>
  </div>

  <div class="card">
    <h3>Kataloogi viimased</h3>
    {% if recent and recent|length %}
      <table>
        <tr><th>Cover</th><th>Lugu</th><th>Artist</th><th>Link</th></tr>
        {% for tid, r in meta.tracks.items()|list()[-10:] %}
        <tr>
          <td>{% if r.artworkUrl100 %}<img src="{{ r.artworkUrl100 }}" width="60">{% endif %}</td>
          <td>{{ r.trackName }}</td>
          <td>{{ r.artistName }}</td>
          <td>{% if r.trackViewUrl %}<a href="{{ r.trackViewUrl }}" target="_blank">iTunes</a>{% endif %}</td>
        </tr>
        {% endfor %}
      </table>
    {% else %}
      <p>Veel pole laetud. Tee samm 1.</p>
    {% endif %}
  </div>

  <p style="color:#9ca3af">NB: see on alfa. ‚ÄúVotes‚Äù ‚â• l√§vi viitab suure t√µen√§osusega s√§mpli kasutusele. L√§ve saab muuta env `MATCH_VOTE_THRESHOLD`-iga.</p>
</body>
</html>